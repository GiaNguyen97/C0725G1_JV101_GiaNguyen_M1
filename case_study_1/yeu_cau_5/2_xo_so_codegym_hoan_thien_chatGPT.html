<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>X·ªï S·ªë CodeGym</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background: linear-gradient(135deg, #f9f9f9, #dce9f9);
            margin: 0;
            padding: 20px;
        }

        h1 {
            color: #2c3e50;
        }

        button {
            padding: 10px 20px;
            margin: 10px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            background: #3498db;
            color: white;
            font-size: 16px;
            transition: 0.2s;
        }

        button:hover {
            background: #2980b9;
        }

        table {
            margin: 10px auto;
            border-collapse: collapse;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            overflow: hidden;
        }

        td, th {
            border: 1px solid #ddd;
            padding: 10px;
            font-size: 22px;
            min-width: 45px;
            font-weight: bold;
        }

        th {
            background: #3498db;
            color: white;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin: 15px auto;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
            max-width: 550px;
        }

        #money_result {
            font-size: 20px;
            font-weight: bold;
            color: green;
        }

        .highlight {
            background: #f1c40f;
            animation: blink 0.8s infinite alternate;
        }

        @keyframes blink {
            from {
                background-color: #f1c40f;
            }
            to {
                background-color: #f39c12;
            }
        }
    </style>
</head>
<body>
<h1>X·ªî S·ªê CODEGYM</h1>
<div id="display" class="card"></div>
<div id="choose_ticket" class="card"></div>
<div id="result" class="card"></div>
<p id="str_result"></p>
<p id="money_result"></p>

<script>
    class Purchaser {
        constructor() {
            this.myTicket = [];
            this.isChoosingTicket = false;
        }

        setMyTicket(ticket) {
            this.myTicket.push(ticket);
        }

        getMyTicket() {
            return this.myTicket;
        }

        buyTicket() {
            if (this.isChoosingTicket) return alert('X√°c nh·∫≠n v√© tr∆∞·ªõc khi mua v√© m·ªõi!');
            if (this.myTicket.length >= 4) return alert('Ch·ªâ ƒë∆∞·ª£c mua t·ªëi ƒëa 4 v√©');

            const method = +prompt("Ch·ªçn ph∆∞∆°ng th·ª©c mua v√©:\n1. T·ª± ch·ªçn\n2. Random");
            method === 1 ? this.chooseTicket() : this.randomTicket();
        }

        chooseTicket() {
            this.isChoosingTicket = true;
            let html = `<table><tr>`;
            for (let i = 0; i < 6; i++) {
                html += `<td><select id="select_${i}">` +
                    Array.from({length: 100}, (_, j) =>
                        `<option value="${String(j).padStart(2, '0')}">${String(j).padStart(2, '0')}</option>`
                    ).join("") +
                    `</select></td>`;
            }
            html += `</tr></table><button onclick="purchaser.confirmTicket()">X√°c nh·∫≠n v√©</button>`;
            document.getElementById('choose_ticket').innerHTML = html;
        }

        confirmTicket() {
            const ticket = Array.from({length: 6}, (_, i) =>
                document.getElementById(`select_${i}`).value
            );
            this.setMyTicket(ticket);
            this.isChoosingTicket = false;
            document.getElementById('choose_ticket').innerHTML = '';
            company.display();
        }

        randomTicket() {
            const ticket = Array.from({length: 6}, () =>
                String(Math.floor(Math.random() * 100)).padStart(2, '0')
            );
            this.setMyTicket(ticket);
            company.display();
        }

        checkResult() {
            const result = company.result;
            document.getElementById('result').innerHTML = `
    <h3>K·∫øt qu·∫£ ƒëang quay...</h3>
    <table id="resultTable"><tr>
      ${Array(6).fill(0).map(() => `<td>??</td>`).join('')}
    </tr></table>
  `;

            const cells = document.querySelectorAll("#resultTable td");

            // quay t·ª´ ph·∫£i qua tr√°i
            [...cells].reverse().forEach((cell, index) => {
                let interval = setInterval(() => {
                    cell.innerText = String(Math.floor(Math.random() * 100)).padStart(2, "0");
                }, 100);

                setTimeout(() => {
                    clearInterval(interval);
                    cell.innerText = result[cells.length - 1 - index]; // g√°n k·∫øt qu·∫£ th·∫≠t
                    cell.classList.add("highlight");
                }, 1500 + index * 800);
            });

            setTimeout(() => this.showPrize(result), 1500 + 6 * 800 + 500);
        }

        showPrize(result) {
            const rewards = {
                6: {name: "Gi·∫£i Nh·∫•t", money: 1_000_000_000},
                5: {name: "Gi·∫£i Nh√¨", money: 500_000_000},
                4: {name: "Gi·∫£i Ba", money: 100_000_000},
                3: {name: "Gi·∫£i Khuy·∫øn kh√≠ch", money: 500_000}
            };

            let money = 0;
            let prizeCount = {3: 0, 4: 0, 5: 0, 6: 0};

            this.myTicket.forEach(ticket => {
                let count = 0;
                // check t·ª´ ph·∫£i sang tr√°i
                for (let i = 5; i >= 0; i--) {
                    if (ticket[i] === result[i]) {
                        count++;
                    } else break; // ng·ª´ng khi sai 1 s·ªë
                }
                if (rewards[count]) {
                    prizeCount[count]++;
                    money += rewards[count].money;
                }
            });

            if (money === 0) {
                alert("Ch√∫c b·∫°n may m·∫Øn l·∫ßn sau!");
                document.getElementById('str_result').innerText = "B·∫°n kh√¥ng tr√∫ng gi·∫£i n√†o üò¢";
                document.getElementById('money_result').innerText = "";
                return;
            }

            alert("üéâ B·∫°n ƒë√£ tr√∫ng th∆∞·ªüng!");
            let str = Object.keys(prizeCount)
                .filter(k => prizeCount[k] > 0)
                .map(k => `${prizeCount[k]} v√© ${rewards[k].name}`)
                .join(", ");

            document.getElementById('str_result').innerText = "B·∫°n tr√∫ng: " + str;
            document.getElementById('money_result').innerText =
                "T·ªïng ti·ªÅn: " + new Intl.NumberFormat('vi-VN').format(money) + " VNƒê";
        }
    }

    class Company {
        constructor(result) {
            this.result = result;
        }

        display() {
            const tickets = purchaser.getMyTicket().map((t, i) => `
          <table><tr><th>V√© ${i + 1}</th>${t.map(n => `<td>${n}</td>`).join('')}</tr></table>
        `).join('');
            document.getElementById('display').innerHTML = tickets +
                `<button onclick="purchaser.buyTicket()">Mua v√©</button>` +
                `<button onclick="purchaser.checkResult()">Xem k·∫øt qu·∫£</button>`;
        }
    }

    const company = new Company(["00", "00", "00", "00", "00", "00"]);
    const purchaser = new Purchaser();
    company.display();
</script>
</body>
</html>
